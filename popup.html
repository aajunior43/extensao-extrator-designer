<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Extractor de Estilo</title>
  <style>
    :root {
      color-scheme: light dark;
      --primary-color: #6366f1;
      --primary-hover: #5855eb;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
      --border-hover: #cbd5e1;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-tertiary: #334155;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-muted: #64748b;
        --border-color: #334155;
        --border-hover: #475569;
      }
    }
    
    * { box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      min-width: 380px;
      max-width: 480px;
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 14px;
      line-height: 1.5;
    }
    
    header {
      padding: 20px 24px 16px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.1;
    }
    
    h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 8px 0;
      position: relative;
      z-index: 1;
    }
    
    .status {
      font-size: 13px;
      opacity: 0.9;
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success-color);
      animation: pulse 2s infinite;
    }
    
    .status-indicator.error { background: var(--error-color); }
    
    main {
      padding: 24px;
      display: grid;
      gap: 20px;
    }
    
    .input-group {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }
    
    input[type="password"], input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
    }
    
    button {
      appearance: none;
      border: 2px solid transparent;
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 12px 16px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      min-height: 44px;
    }
    
    button:hover:not(:disabled) {
      background: var(--bg-tertiary);
      border-color: var(--border-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }
    
    button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    button[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .btn-primary:hover:not(:disabled) {
      background: var(--primary-hover);
      border-color: var(--primary-hover);
    }
    
    .btn-success {
      background: var(--success-color);
      color: white;
      border-color: var(--success-color);
    }
    
    .btn-icon {
      padding: 12px;
      min-width: 44px;
    }
    
    .action-row {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    textarea {
      width: 100%;
      min-height: 240px;
      resize: vertical;
      padding: 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      transition: all 0.2s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgb(99 102 241 / 0.1);
    }
    
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }
    
    .muted {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    .progress {
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-color);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      display: inline-block;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 16px;
    }
    
    .icon {
      width: 16px;
      height: 16px;
      display: inline-block;
    }
    
    /* Loading states e animações melhoradas */
    .btn-loading {
      position: relative;
      color: transparent !important;
    }
    
    .btn-loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      margin: -8px 0 0 -8px;
      border: 2px solid currentColor;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    .progress-bar {
      width: 100%;
      height: 4px;
      background: var(--border-color);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 8px;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
      border-radius: 2px;
      transition: width 0.3s ease;
      position: relative;
    }
    
    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .success-flash {
      animation: successFlash 0.6s ease-out;
    }
    
    @keyframes successFlash {
      0% { background-color: var(--success-color); }
      100% { background-color: transparent; }
    }
    
    /* Skeleton loading para textarea */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-tertiary) 50%, var(--bg-secondary) 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
    }
    
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Tooltip melhorado */
    [title] {
      position: relative;
    }
    
    [title]:hover::after {
      content: attr(title);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--text-primary);
      color: var(--bg-primary);
      padding: 6px 8px;
      border-radius: var(--radius-sm);
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      margin-bottom: 5px;
      opacity: 0;
      animation: tooltipFadeIn 0.2s ease-out forwards;
    }
    
    @keyframes tooltipFadeIn {
      to { opacity: 1; }
    }
    
    /* Estados de foco melhorados para acessibilidade */
    button:focus-visible,
    input:focus-visible,
    textarea:focus-visible {
      outline: 3px solid var(--primary-color);
      outline-offset: 2px;
      box-shadow: 0 0 0 1px var(--bg-primary);
    }
    
    /* Melhor contraste para modo escuro */
    @media (prefers-color-scheme: dark) {
      button:focus-visible,
      input:focus-visible,
      textarea:focus-visible {
        outline-color: #818cf8;
      }
    }
    
    /* Suporte para usuários que preferem movimento reduzido */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
    
    /* Melhor contraste para texto */
    .high-contrast {
      --text-primary: #000000;
      --text-secondary: #333333;
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
    }
    
    @media (prefers-color-scheme: dark) {
      .high-contrast {
        --text-primary: #ffffff;
        --text-secondary: #cccccc;
        --bg-primary: #000000;
        --bg-secondary: #1a1a1a;
      }
    }
    
    /* Indicadores visuais para estado de carregamento */
    [aria-busy="true"] {
      cursor: wait;
    }
    
    /* Melhor visibilidade para elementos interativos */
    button, input, textarea {
      min-height: 44px; /* Tamanho mínimo recomendado para toque */
    }
    
    /* Transições suaves (respeitando preferências de movimento) */
     * {
       transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
     }
     
     /* Micro-interações e melhorias visuais */
     button:not(:disabled):hover {
       filter: brightness(1.05);
     }
     
     .card:hover {
       box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
       transform: translateY(-2px);
     }
     
     input:focus {
       transform: scale(1.02);
     }
     
     .status-indicator {
       box-shadow: 0 0 10px currentColor;
     }
     
     /* Melhor feedback visual para botões */
     .btn-primary:hover:not(:disabled) {
       box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
     }
     
     .btn-success:hover:not(:disabled) {
       box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
     }
     
     /* Animação de entrada para elementos */
     .card, .action-row, textarea, .footer {
       animation: slideInUp 0.4s ease-out;
     }
     
     @keyframes slideInUp {
       from {
         opacity: 0;
         transform: translateY(20px);
       }
       to {
         opacity: 1;
         transform: translateY(0);
       }
     }
     
     /* Delay escalonado para animações */
     .card { animation-delay: 0.1s; }
     .action-row { animation-delay: 0.2s; }
     textarea { animation-delay: 0.3s; }
     .footer { animation-delay: 0.4s; }
     
     /* Tooltip melhorado */
     [data-tooltip] {
       position: relative;
     }
     
     [data-tooltip]:hover::after {
       content: attr(data-tooltip);
       position: absolute;
       bottom: 100%;
       left: 50%;
       transform: translateX(-50%);
       background: var(--text-primary);
       color: var(--bg-primary);
       padding: 8px 12px;
       border-radius: var(--radius-sm);
       font-size: 12px;
       white-space: nowrap;
       z-index: 1000;
       margin-bottom: 8px;
       opacity: 0;
       animation: tooltipFadeIn 0.3s ease-out 0.5s forwards;
       pointer-events: none;
     }
     
     [data-tooltip]:hover::before {
       content: '';
       position: absolute;
       bottom: 100%;
       left: 50%;
       transform: translateX(-50%);
       border: 4px solid transparent;
       border-top-color: var(--text-primary);
       z-index: 1001;
       margin-bottom: 4px;
       opacity: 0;
       animation: tooltipFadeIn 0.3s ease-out 0.5s forwards;
     }
    
    /* Skip link para navegação por teclado */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--primary-color);
      color: white;
      padding: 8px;
      text-decoration: none;
      border-radius: 4px;
      z-index: 1000;
    }
    
    .skip-link:focus {
       top: 6px;
     }
     
     /* Dropdown de exportação */
     .dropdown {
       position: relative;
       display: inline-block;
     }
     
     .dropdown-menu {
       position: absolute;
       top: 100%;
       right: 0;
       background: var(--bg-primary);
       border: 2px solid var(--border-color);
       border-radius: var(--radius-md);
       box-shadow: var(--shadow-md);
       min-width: 160px;
       z-index: 1000;
       opacity: 0;
       visibility: hidden;
       transform: translateY(-10px);
       transition: all 0.2s ease;
     }
     
     .dropdown-menu.show {
       opacity: 1;
       visibility: visible;
       transform: translateY(0);
     }
     
     .dropdown-menu button {
       width: 100%;
       text-align: left;
       padding: 12px 16px;
       border: none;
       background: transparent;
       border-radius: 0;
       justify-content: flex-start;
       min-height: auto;
     }
     
     .dropdown-menu button:first-child {
       border-radius: var(--radius-md) var(--radius-md) 0 0;
     }
     
     .dropdown-menu button:last-child {
       border-radius: 0 0 var(--radius-md) var(--radius-md);
     }
     
     .dropdown-menu button:hover {
       background: var(--bg-secondary);
       transform: none;
       box-shadow: none;
     }
     
     .arrow {
       font-size: 10px;
       margin-left: 4px;
       transition: transform 0.2s ease;
     }
     
     .dropdown[aria-expanded="true"] .arrow {
       transform: rotate(180deg);
     }
     
     /* Modal de histórico */
     .modal {
       position: fixed;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       background: rgba(0, 0, 0, 0.5);
       display: flex;
       align-items: center;
       justify-content: center;
       z-index: 2000;
       opacity: 0;
       visibility: hidden;
       transition: all 0.3s ease;
     }
     
     .modal.show {
       opacity: 1;
       visibility: visible;
     }
     
     .modal-content {
       background: var(--bg-primary);
       border-radius: var(--radius-lg);
       padding: 24px;
       max-width: 90vw;
       max-height: 80vh;
       overflow-y: auto;
       box-shadow: var(--shadow-md);
       transform: scale(0.9);
       transition: transform 0.3s ease;
     }
     
     .modal.show .modal-content {
       transform: scale(1);
     }
     
     .modal-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-bottom: 20px;
       padding-bottom: 16px;
       border-bottom: 1px solid var(--border-color);
     }
     
     .modal-title {
       font-size: 18px;
       font-weight: 600;
       margin: 0;
     }
     
     .close-btn {
       background: none;
       border: none;
       font-size: 24px;
       cursor: pointer;
       padding: 4px;
       border-radius: var(--radius-sm);
       min-height: auto;
     }
     
     .history-item {
       border: 1px solid var(--border-color);
       border-radius: var(--radius-md);
       padding: 16px;
       margin-bottom: 12px;
       background: var(--bg-secondary);
     }
     
     .history-item-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-bottom: 8px;
     }
     
     .history-item-title {
       font-weight: 600;
       font-size: 14px;
     }
     
     .history-item-date {
       font-size: 12px;
       color: var(--text-muted);
     }
     
     .history-item-preview {
       font-size: 13px;
       color: var(--text-secondary);
       line-height: 1.4;
       margin-bottom: 12px;
       max-height: 60px;
       overflow: hidden;
       position: relative;
     }
     
     .history-item-preview::after {
       content: '';
       position: absolute;
       bottom: 0;
       left: 0;
       right: 0;
       height: 20px;
       background: linear-gradient(transparent, var(--bg-secondary));
     }
     
     .history-item-actions {
       display: flex;
       gap: 8px;
     }
     
     .history-item-actions button {
       font-size: 12px;
       padding: 6px 12px;
       min-height: auto;
     }
     
     .empty-history {
       text-align: center;
       color: var(--text-muted);
       padding: 40px 20px;
     }
     
     .empty-history .icon {
       font-size: 48px;
       margin-bottom: 16px;
       opacity: 0.5;
     }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Pular para conteúdo principal</a>
  
  <header role="banner">
    <h1>🎨 Extractor de Estilo</h1>
    <div class="status" id="status" role="status" aria-live="polite">
      <span class="status-indicator" id="statusIndicator" aria-hidden="true"></span>
      <span id="statusText">API key: desconhecida</span>
    </div>
  </header>
  
  <main id="main-content" role="main">
    <section class="card" aria-labelledby="api-key-section">
      <h2 id="api-key-section" class="sr-only">Configuração da API Key</h2>
      <div class="input-group">
        <label for="apiKeyInput" class="sr-only">Chave da API do Gemini</label>
        <input 
          id="apiKeyInput" 
          type="password" 
          placeholder="Cole sua API key do Gemini (AIza...)" 
          aria-describedby="api-key-help"
          autocomplete="off"
          spellcheck="false"
        />
        <div id="api-key-help" class="sr-only">
          Insira sua chave da API do Google Gemini para gerar prompts de estilo
        </div>
        <button 
           id="saveKeyBtn" 
           class="btn-success" 
           aria-label="Salvar chave da API"
           data-tooltip="Salva a API key no navegador (Alt+S)"
         >
           <span class="icon" aria-hidden="true">💾</span>
           Salvar
         </button>
         <button 
           id="toggleKeyBtn" 
           class="btn-icon" 
           aria-label="Mostrar ou ocultar chave da API"
           aria-pressed="false"
           data-tooltip="Alterna visibilidade da chave (Alt+T)"
         >
           <span class="icon" aria-hidden="true">👁</span>
         </button>
      </div>
    </section>
    
    <section aria-labelledby="actions-section">
      <h2 id="actions-section" class="sr-only">Ações principais</h2>
      <div class="action-row">
         <button 
           id="generateBtn" 
           class="btn-primary" 
           style="flex: 1;"
           aria-describedby="generate-help"
           data-tooltip="Analisa a página e gera prompt detalhado (Ctrl+Enter)"
         >
           <span class="icon" aria-hidden="true">✨</span>
           Gerar prompt com Gemini
         </button>
         <div id="generate-help" class="sr-only">
           Analisa os estilos da página atual e gera um prompt detalhado
         </div>
         <button 
           id="copyBtn" 
           aria-label="Copiar resultado para área de transferência" 
           disabled
           data-tooltip="Copia o resultado para área de transferência (Alt+C)"
         >
           <span class="icon" aria-hidden="true">📋</span>
           Copiar
         </button>
         <div class="dropdown" id="exportDropdown">
            <button 
              id="exportBtn" 
              aria-label="Exportar resultado em diferentes formatos"
              aria-haspopup="true"
              aria-expanded="false"
              disabled
              data-tooltip="Exporta em diferentes formatos (TXT, MD, JSON)"
            >
              <span class="icon" aria-hidden="true">📤</span>
              <span class="icon arrow" aria-hidden="true">▼</span>
            </button>
           <div class="dropdown-menu" id="exportMenu" role="menu">
             <button role="menuitem" id="exportTxt" aria-label="Exportar como arquivo de texto">
               <span class="icon" aria-hidden="true">📄</span>
               Texto (.txt)
             </button>
             <button role="menuitem" id="exportMd" aria-label="Exportar como Markdown">
               <span class="icon" aria-hidden="true">📝</span>
               Markdown (.md)
             </button>
             <button role="menuitem" id="exportJson" aria-label="Exportar dados como JSON">
               <span class="icon" aria-hidden="true">🔧</span>
               JSON (.json)
             </button>
           </div>
         </div>
         <button 
            id="historyBtn" 
            aria-label="Ver histórico de prompts gerados"
            data-tooltip="Visualiza e gerencia prompts anteriores"
          >
            <span class="icon" aria-hidden="true">📚</span>
          </button>
       </div>
    </section>
    
    <section aria-labelledby="result-section">
      <label for="result" id="result-section" class="sr-only">Resultado do prompt gerado</label>
      <textarea 
        id="result" 
        placeholder="O prompt detalhado aparecerá aqui...&#10;&#10;• Navegue até qualquer site&#10;• Clique em 'Gerar prompt com Gemini'&#10;• Aguarde a análise dos estilos&#10;• O resultado aparecerá aqui para copiar"
        aria-describedby="result-help"
        readonly
      ></textarea>
      <div id="result-help" class="sr-only">
        Área de texto contendo o prompt gerado. Use Ctrl+A para selecionar tudo.
      </div>
    </section>
    
    <footer class="footer" role="contentinfo">
      <span class="muted">
        Configure em 
        <a id="optionsLink" href="#" aria-label="Abrir página de configurações">
          Opções
        </a>
      </span>
      <div id="progress" class="progress" role="status" aria-live="polite" aria-label="Progresso da operação"></div>
    </footer>
  </main>
  
  <!-- Classe para elementos que devem ser lidos por leitores de tela mas não visíveis -->
  <style>
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
   
   <!-- Modal de Histórico -->
   <div id="historyModal" class="modal" role="dialog" aria-labelledby="history-modal-title" aria-hidden="true">
     <div class="modal-content">
       <div class="modal-header">
         <h3 id="history-modal-title" class="modal-title">📚 Histórico de Prompts</h3>
         <button class="close-btn" id="closeHistoryModal" aria-label="Fechar histórico">
           ×
         </button>
       </div>
       <div id="historyContent">
         <div class="empty-history">
           <div class="icon">📝</div>
           <p>Nenhum prompt gerado ainda.</p>
           <p>Gere seu primeiro prompt para começar o histórico!</p>
         </div>
       </div>
     </div>
   </div>
   
   <script src="popup.js"></script>
 </body>
</html>